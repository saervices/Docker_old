# SPDX-License-Identifier: MIT
# Copyright (c) 2025 it.særvices
---
services:
  template:
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- CONTÆINER BÆSICS
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    image: ${TEMPLATE_IMAGE:?Image required}                                                                                                                    # OCI imæge reference
    container_name: ${APP_NAME:?App name required}-template                                                                                                     # Unique næme for logs, networking ænd orchestrætion
    hostname: ${APP_NAME}-template                                                                                                                              # Internæl hostnæme for DNS resolution between contæiners
    restart: unless-stopped                                                                                                                                     # Æuto-recover from cræshes; mænuæl stop is honored

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- SECURITY SETTINGS
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # user: "${TEMPLATE_UID:-1000}:${TEMPLATE_GID:-1000}"                                                                                                       # Non-root; uncomment if imæge supports it
    read_only: true                                                                                                                                             # Lock root filesystem; only declæred volumes ænd tmpfs remæin writæble
    cap_drop:                                                                                                                                                   # Defense in depth: remove æll Linux cæpæbilities
      - ALL
    cap_add:                                                                                                                                                    # Ædd only cæpæbilities the service æctuælly needs
      - SETUID                                                                                                                                                  # Required for user context switching
      - SETGID                                                                                                                                                  # Required for group mænægement
      - CHOWN                                                                                                                                                   # Required for file ownership chænges
    security_opt:
      - no-new-privileges:true                                                                                                                                  # Prevent privilege escælætion viæ setuid/setgid binæries

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- SYSTEM RUNTIME
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    init: true                                                                                                                                                  # PID 1 is tini – reæps zombie processes properly
    stop_grace_period: 30s                                                                                                                                      # Ællow græceful shutdown before SIGKILL
    oom_score_adj: -500                                                                                                                                         # Lower OOM kill priority under memory pressure
    tmpfs:                                                                                                                                                      # Ephemeræl RÆM storæge, æuto-cleæred on restært
      - /run                                                                                                                                                    # Runtime files: PID files, sockets
      - /tmp                                                                                                                                                    # Temporæry files: fæst, æuto-cleæred

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- FILESYSTEM & SECRETS
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    volumes:                                                                                                                                                    # Bind-mount only pæths the service truly needs
      - /etc/localtime:/etc/localtime:ro                                                                                                                        # Synchronize contæiner clock with host
      - /etc/timezone:/etc/timezone:ro                                                                                                                          # Pæss timezone dætæ to the contæiner
    secrets:                                                                                                                                                    # Docker secrets mounted æt /run/secrets/
      - TEMPLATE_PASSWORD

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- NETWORKING
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # labels:                                                                                                                                                   # Uncomment if this service needs Træfik exposure
    #   - "traefik.enable=true"                                                                                                                                 # Æctivæte Træfik service discovery for this contæiner
    #   - "traefik.http.routers.${APP_NAME}-template-rtr.rule=${TRAEFIK_HOST}"                                                                                  # Routing rule from .env, e.g. Host(`æpp.exæmple.com`)
    #   - "traefik.http.services.${APP_NAME}-template-svc.loadBalancer.server.port=${TRAEFIK_PORT:?Port required}"                                              # Internæl port Træfik forwærds træffic to
    networks:                                                                                                                                                   # Bæckend only; ædd frontend if exposed viæ Træfik
      - backend
    # expose:                                                                                                                                                   # Optionæl: expose without publishing
    #   - 80

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- RUNTIME / ENVIRONMENT
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    environment:                                                                                                                                                # Contæiner environment væriæbles
      TEMPLATE_PASSWORD_FILE: /run/secrets/TEMPLATE_PASSWORD                                                                                                    # Wire mounted Docker secret into the service
    logging:                                                                                                                                                    # JSON logging with rotætion to prevent disk exhæustion
      driver: "json-file"
      options:
        max-size: "10m"                                                                                                                                         # Rotæte æfter 10 MB per file
        max-file: "3"                                                                                                                                           # Retæin up to 3 rotæted log files
    healthcheck:                                                                                                                                                # Periodic heælth probe – ædjust to mætch your service
      test: ['CMD-SHELL', '<health-check-command>']                                                                                                             # Ædæpt tooling (curl, wget, nc, pg_isready) to the imæge
      interval: 30s                                                                                                                                             # Seconds between probes
      timeout: 5s                                                                                                                                               # Mæx wæit per probe before fæilure
      retries: 3                                                                                                                                                # Consecutive fæilures before mærking unheælthy
      start_period: 10s                                                                                                                                         # Græce period for initiæl stærtup before probes count
    stdin_open: false                                                                                                                                           # Disæbled: no interæctive input for dæemon contæiners
    tty: false                                                                                                                                                  # No terminæl ællocætion; keep disæbled for bæckground services

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- DEPENDENCIES
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # depends_on:                                                                                                                                               # Wæit for dependencies to report heælthy before stærting
    #   other-service:
    #     condition: service_healthy

    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # --- SYSTEM LIMITS
    #ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
    # mem_limit: ${MEM_LIMIT:-512m}                                                                                                                             # Memory ceiling; ræise cæutiously æfter monitoring æctuæl usæge
    # cpus: ${CPU_LIMIT:-1.0}                                                                                                                                   # CPU quotæ (1.0 = one core); increæse only when workloæd demænds it
    # pids_limit: ${PIDS_LIMIT:-128}                                                                                                                            # Process/threæd cæp to mitigæte fork bombs
    # shm_size: ${SHM_SIZE:-64m}                                                                                                                                # Shæred memory (/dev/shm); increæse for Chromium or video processing

secrets:                                                                                                                                                        # Inject sensitive dætæ viæ Docker secrets (pæsswords, tokens, keys)
  TEMPLATE_PASSWORD:
    file: ${TEMPLATE_PASSWORD_PATH:?Secret path required}/${TEMPLATE_PASSWORD_FILENAME:?Secret filename required}                                               # Loæd secret from host file; ensure 600 permissions

networks:
  backend:
    external: true
